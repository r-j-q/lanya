(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/index/index"],{33:function(e,t,n){"use strict";(function(e,t){var o=n(4);n(26);o(n(25));var i=o(n(34));e.__webpack_require_UNI_MP_PLUGIN__=n,t(i.default)}).call(this,n(1)["default"],n(2)["createPage"])},34:function(e,t,n){"use strict";n.r(t);var o=n(35),i=n(37);for(var c in i)["default"].indexOf(c)<0&&function(e){n.d(t,e,(function(){return i[e]}))}(c);n(45);var s,a=n(32),r=Object(a["default"])(i["default"],o["render"],o["staticRenderFns"],!1,null,"57280228",null,!1,o["components"],s);r.options.__file="pages/index/index.vue",t["default"]=r.exports},35:function(e,t,n){"use strict";n.r(t);var o=n(36);n.d(t,"render",(function(){return o["render"]})),n.d(t,"staticRenderFns",(function(){return o["staticRenderFns"]})),n.d(t,"recyclableRender",(function(){return o["recyclableRender"]})),n.d(t,"components",(function(){return o["components"]}))},36:function(e,t,n){"use strict";var o;n.r(t),n.d(t,"render",(function(){return i})),n.d(t,"staticRenderFns",(function(){return s})),n.d(t,"recyclableRender",(function(){return c})),n.d(t,"components",(function(){return o}));var i=function(){var e=this,t=e.$createElement;e._self._c},c=!1,s=[];i._withStripped=!0},37:function(e,t,n){"use strict";n.r(t);var o=n(38),i=n.n(o);for(var c in o)["default"].indexOf(c)<0&&function(e){n.d(t,e,(function(){return o[e]}))}(c);t["default"]=i.a},38:function(e,t,n){"use strict";(function(e,o){var i=n(4);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var c=i(n(39)),s=i(n(41)),a=i(n(42)),r={components:{},data:function(){return{addressInfo:{},showButton:!1,duration:5e3,list:[],deviceId:"",serviceId:"",characteristics:[],characteristicId:"",lanya:n(43),getLocation:n(44),getUserInfo:{},getUserInfoDataToken:!1,code:"",address:"",latitude:"",longitude:"",address_component:{},timer:null,openLanYa:!0}},onLoad:function(){},onShow:function(){e.startLocationUpdate({type:"wgs84",success:function(e){console.log("7777resres777777777",e);e.latitude,e.longitude}})},methods:{getAddressList:function(){var e=this;o.chooseAddress({success:function(t){e.addressInfo=t}})},getLocationgetLocation:function(){var e=this;o.getLocation({type:"wgs84",success:function(t){t.speed,t.accuracy;var n=t.latitude,o=t.longitude;e.setData({latitude:t.latitude,longitude:t.longitude});var i=new a.default({key:"****"});i.reverseGeocoder({location:{latitude:n,longitude:o},success:function(t){console.log(t),e.setData({address:t.result.address})},fail:function(e){console.log(e)},complete:function(e){console.log(e)}})}})},openAuthSetting:function(){var t=this,n=this;e.getSetting({success:function(o){console.log(o,JSON.stringify(o,"getSetting")),void 0!=o.authSetting["scope.userLocation"]&&1!=o.authSetting["scope.userLocation"]?e.showModal({title:"请求授权当前位置",content:"需要获取您的地理位置，请确认授权",success:function(t){t.cancel?e.showToast({title:"拒绝授权",icon:"none"}):t.confirm&&e.openSetting({success:function(t){console.log(t,"openSetting"),1==t.authSetting["scope.userLocation"]?(e.showToast({title:"授权成功",icon:"none"}),n.getLocation()):e.showToast({title:"授权失败",icon:"none"})}})}}):(o.authSetting["scope.userLocation"],t.getLocation())},complete:function(){console.log("getSetting")}})},handleLanya:function(){var t=this,i=n(42),c=new i({key:"OB7BZ-S6FWT-GOBXR-LONYL-GKEE5-OTBRD"});o.getLocation({type:"wgs84",success:function(e){console.log("纬度--------\x3e",e),t.latitude=e.latitude,t.longitude=e.longitude,o.setStorageSync("latitude",e.latitude),o.setStorageSync("longitude",e.longitude)},fail:function(n){e.showToast({title:"授权未通过",icon:"none"}),t.openAuthSetting()},complete:function(){c.reverseGeocoder({location:{latitude:o.getStorageSync("latitude"),longitude:o.getStorageSync("longitude")},success:function(e){t.address=e.result.address,t.address_component=e.result.address_component,console.log("11",e.result),t.loginfn(),o.setStorageSync("address_component",e.result.address_component.city)},fail:function(e){console.error("错误了",e)}})}})},loginfn:function(){var e=this;o.login({success:function(t){e.getawardDetail(t.code)}})},onGetPhoneNumber:function(e){var t=this;return(0,s.default)(c.default.mark((function n(){var o;return c.default.wrap((function(n){while(1)switch(n.prev=n.next){case 0:t,"getPhoneNumber:ok"===e.detail.errMsg&&(o=e.detail,o.iv,o.encryptedData);case 2:case"end":return n.stop()}}),n)})))()},getawardDetail:function(t){var n=this;return(0,s.default)(c.default.mark((function o(){return c.default.wrap((function(o){while(1)switch(o.prev=o.next){case 0:return n,o.next=3,e.request({url:"https://ys.shningmi.com/api/login/login",data:{code:t},header:{"Content-Type":"application/json"},method:"POST",success:function(t){var o=t.data;e.setStorageSync("usersInfo",JSON.stringify(o)),n.getUserInfo=JSON.parse(e.getStorageSync("usersInfo")),console.log("缓存数据--2----",n.getUserInfo.data.userinfo),n.getUserInfo.data&&n.getUserInfo.data.userinfo&&(console.log("缓存数据--2----",n.getUserInfo.data.userinfo),n.getUserInfoDataToken=!!n.getUserInfo.data.userinfo)}});case 3:case"end":return o.stop()}}),o)})))()},handleOpenBluetoothAdapter:function(){var t=this;this.openLanYa?(e.showLoading({title:"请打开手机蓝牙"}),console.log("66666666666")):(console.log("888888888888"),this.openLanYa=!1,clearInterval(this.timer),e.hideLoading()),e.openBluetoothAdapter({success:function(n){e.getBluetoothAdapterState({success:function(n){t.openLanYa=!1,clearInterval(t.timer),console.log(n,"本机设备的蓝牙已打开"),e.hideLoading(),t.startBluetoothDeviceDiscovery()},fail:function(t){e.showToast({icon:"none",duration:this.duration,title:"查看手机蓝牙是否打开"})}})},fail:function(e){}})},startBluetoothDeviceDiscovery:function(){var t=this;e.startBluetoothDevicesDiscovery({success:function(e){console.log("startBluetoothDevicesDiscovery success",e),t.onBluetoothDeviceFound()},fail:function(e){console.log(e,"错误信息")}})},onBluetoothDeviceFound:function(){var t=this;e.onBluetoothDeviceFound((function(e){-1==t.list.indexOf(e.devices[0].deviceId)&&"WMD8"===e.devices[0].name.slice(0,4)&&(t.createBLEConnection(e.devices[0].deviceId),t.list.push({name:e.devices[0].name,deviceId:e.devices[0].deviceId}))}))},getBluetoothDevices:function(){console.log("获取蓝牙设备"),e.getBluetoothDevices({success:function(e){console.log("获取蓝牙设备成功:"),console.log(e.devices)}})},createBLEConnection:function(t){var n=this;this.deviceId=t,e.createBLEConnection({deviceId:this.deviceId,success:function(e){console.log("蓝牙连接成功",e),n.getBLEDeviceServices()},fail:function(e){console.log("蓝牙连接失败",e)}})},stopBluetoothDevicesDiscovery:function(){var t=this;e.stopBluetoothDevicesDiscovery({success:function(e){t.loading=!1,console.log("停止搜索蓝牙设备:"+e.errMsg)},fail:function(e){console.log("停止搜索蓝牙设备失败，错误码："+e.errCode)}})},getBLEDeviceCharacteristics:function(){var t=this,n=this;console.log("进入特征"),setTimeout((function(){e.getBLEDeviceCharacteristics({deviceId:t.deviceId,serviceId:t.serviceId,success:function(e){console.log("特征getBLEDeviceCharacteristics",e),t.characteristics=e.characteristics,console.log("特征数组",t.characteristics),e.characteristics.forEach((function(e){-1!=e.uuid.indexOf("FFE1")&&(n.characteristicId=e.uuid,n.notifyBLECharacteristicValueChange(e.uuid))}))},fail:function(e){console.log(e)}})}),1e3)},notifyBLECharacteristicValueChange:function(t){var n=this;console.log(t,"characteristicId"),e.notifyBLECharacteristicValueChange({state:!0,deviceId:this.deviceId,serviceId:this.serviceId,characteristicId:t,success:function(e){console.log(e),n.listenValueChange(),console.log("notifyBLECharacteristicValueChange success",e.errMsg)},fail:function(e){console.log("notifyBLECharacteristicValueChange fail",e.errMsg)}})},getBLEDeviceServices:function(){var t=this;setTimeout((function(){e.getBLEDeviceServices({deviceId:t.deviceId,success:function(e){console.log("获取到蓝牙所有的服务:",e),e.services.forEach((function(e){-1!=e.uuid.indexOf("FFE0")&&(t.serviceId=e.uuid,console.log("1800特征值",t.serviceId),t.getBLEDeviceCharacteristics())}))}})}),1e3)},strToHexCharCode:function(e){if(""===e)return"";var t=[];t.push("0x");for(var n=0;n<e.length;n++)t.push(e.charCodeAt(n).toString(16));return t.join("")},handleInToPay:function(){var t={deviceId:this.deviceId,serviceId:this.serviceId,unids:this.list[0].name.slice(4),characteristicId:this.characteristicId},n=JSON.stringify(t);e.navigateTo({url:"/pages/game/detail?param="+n})},writeBLECharacteristicValue:function(t){var n=this;return(0,s.default)(c.default.mark((function o(){var i,s,a,r,u,l,d;return c.default.wrap((function(o){while(1)switch(o.prev=o.next){case 0:for(console.log("这页面传入PCSS是唤醒功能",t),console.log("这页面传入PCSS是唤醒功能1",n.deviceId),console.log("这页面传入PCSS是唤醒功能2",n.serviceId),console.log("这页面传入PCSS是唤醒功能3",n.characteristicId),i=n.list[0].name.slice(4),s=t+i,a=new ArrayBuffer(s.length),r=new DataView(a),u=0;u<s.length;u++)r.setUint8(u,s.charAt(u).charCodeAt());l=n.ab2hex(a)+"0D0A",d=new Uint8Array(l.match(/[\da-f]{2}/gi).map((function(e){return parseInt(e,16)}))).buffer,console.log("这页面传入PCSS是唤醒功能3buffers",d),e.writeBLECharacteristicValue({deviceId:n.deviceId,serviceId:n.serviceId,characteristicId:n.characteristicId,value:d,success:function(t){console.log("写入成功",t),e.showToast({icon:"none",title:"开启成功"})},fail:function(e){console.log("写入失败1",JSON.stringify(e))}});case 13:case"end":return o.stop()}}),o)})))()},string2buffer:function(e){for(var t="",n=0;n<e.length;n++)""===t?t=e.charCodeAt(n).toString(16):t+=","+e.charCodeAt(n).toString(16);return console.log("16数据",t),new Uint8Array(t.match(/[\da-f]{2}/gi).map((function(e){return parseInt(e,16)}))).buffer},str2ab:function(e){for(var t=new ArrayBuffer(e.length/2),n=new Uint8Array(t),o=0;o<n.length;o++)n[o]=parseInt(e.substr(2*o,2),16);return t},ab2hex:function(e){var t=Array.prototype.map.call(new Uint8Array(e),(function(e){return e.toString(16).slice(-2)}));return t.join("")},hexCharCodeToStr:function(e){var t,n=e.trim(),o="0x"===n.substr(0,2).toLowerCase()?n.substr(2):n,i=o.length;if(i%2!==0)return alert("存在非法字符!"),"";for(var c=[],s=0;s<i;s+=2)t=parseInt(o.substr(s,2),16),c.push(String.fromCharCode(t));return c.join("")},listenValueChange:function(){var t=this;console.log("进去了吗"),t.showButton=!0,e.onBLECharacteristicValueChange((function(e){console.log("进去了吗1111",e);var n=t.ab2hex(e.value);console.log(n);var o=t.hexCharCodeToStr(n);console.log("最终结果",o)}))},openBluetoothAdapterPay:function(){var t=this;e.openBluetoothAdapter({success:function(e){t.createorder("PBSS",1),console.log("7777777")},fail:function(n){t.showButton=!1,e.showModal({title:"提示",content:"请开启蓝牙后，重新扫码"}),10001===n.errCode&&console.log("---------------")}})},createorder:function(t,n){var o=this;e.request({url:"https://ys.shningmi.com/api/order/create",data:{guid:"guid",qty:n,address:o.address,latitude:o.latitude,longitude:o.longitude},header:{"Content-Type":"application/json",token:o.getUserInfo.data.token},method:"POST",success:function(n){e.requestPayment({provider:"wxpay",timeStamp:n.data.data.timeStamp,nonceStr:n.data.data.nonceStr,package:n.data.data.package,signType:n.data.data.signType,paySign:n.data.data.sign,success:function(e){console.log("支付成功",e),o.writeBLECharacteristicValue(t)},fail:function(e){console.log("支付失败",e)}})}})}}};t.default=r}).call(this,n(2)["default"],n(1)["default"])},45:function(e,t,n){"use strict";n.r(t);var o=n(46),i=n.n(o);for(var c in o)["default"].indexOf(c)<0&&function(e){n.d(t,e,(function(){return o[e]}))}(c);t["default"]=i.a},46:function(e,t,n){}},[[33,"common/runtime","common/vendor"]]]);
//# sourceMappingURL=../../../.sourcemap/mp-weixin/pages/index/index.js.map